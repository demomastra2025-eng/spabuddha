## Buddha Spa Certificates

Фронтенд/бэкенд приложение для продажи подарочных сертификатов Buddha Spa:

- шаговый конструктор сертификата (филиал, данные получателя, дизайн, доставка, оплата);
- предпросмотр с генерацией PDF;
- интеграции OneVision (оплата), Resend/SMTP (email), Wazzup (WhatsApp);
- админ‑панель для управления филиалами, услугами и шаблонами.

### Быстрый старт

```bash
pnpm install
cp .env.example .env  # заполните переменные окружения
pnpm dev              # запускает API (Express) и Vite
```

Приложение доступно на http://localhost:5173, API — на http://localhost:3000.

### Основные переменные окружения

| Переменная | Назначение |
|-----------|-----------|
| `DATABASE_URL` | строка подключения к PostgreSQL |
| `APP_BASE_URL` | публичный адрес фронтенда (нужен для callback’ов) |
| `WAZZUP_*` | параметры WhatsApp-интеграции |
| `RESEND_*` или SMTP‑параметры | отправка e-mail |
| `ONEVISION_*` | настройки платёжного провайдера |

Полный список см. в `src/server/config/env.ts`.

### Основные команды

| Команда | Описание |
|---------|----------|
| `pnpm dev` | локальный запуск API + клиент |
| `pnpm dev:ngrok` | dev-сервер + туннель Ngrok для тестов callback’ов |
| `pnpm build` | сборка клиента |
| `pnpm lint` | ESLint для всего репо |
| `pnpm db:schema` | применение `schema.sql` |
| `pnpm db:sync-branches` | синхронизация справочника филиалов |

### Структура

- `server.ts`, `src/server` — Express API.
- `src/components`, `src/pages` — React/Vite интерфейс.
- `src/components/create/*` — шаги мастера оформления сертификата.
- `src/pages/AdminDashboard.tsx` — административный интерфейс.

### Тестовые интеграции

Для отправки тестовых сертификатов без оплаты доступны эндпоинты `/api/preview/email` и `/api/preview/whatsapp`, вызываемые кнопками в предпросмотре. Убедитесь, что заданы `RESEND_*`/SMTP и `WAZZUP_*`.

### Лицензия

Проект предназначен для внутреннего использования Buddha Spa. Распространение и форки по согласованию.
